version: "3.1"

rules:
# - rule: start
#   steps:
#     - intent: welcome_greet
#     - action: utter_welcome_greet
- rule: start #Activate form
  steps:
  - intent: item_start_generic
  - action: pizza_order_form
  - active_loop: pizza_order_form
  wait_for_user_input: false

- rule: what pizzas do you have?
  condition:
    - active_loop: pizza_order_form
  steps:
    - intent: request_all_pizzas
    - action: action_get_all_pizzas
    #- action: utter_ask_pizza_type
    - slot_was_set:
      - requested_slot: pizza_type
    - action: pizza_order_form



- rule: Activate form customer details 1
  steps:
  - intent: order_pickup
  - action: customer_details_form
  - active_loop: customer_details_form

- rule: Activate form customer details 2
  steps:
  - intent: order_delivery_address
  - action: customer_details_form
  - active_loop: customer_details_form

# - rule: what meat pizzas do you have?
#   steps:
#     - intent: request_meat_pizzas
#     - action: action_get_meat_pizzas
#     - action: utter_inform_meat_pizzas

# - rule: what vegetarian pizzas do you have?
#   steps:
#     - intent: request_vege_pizzas
#     - action: action_get_vege_pizzas
#     - action: utter_inform_vege_pizzas

#- rule: what pizzas do you have?
  #condition:
  #  - active_loop: pizza_order_form
#  steps:
#    - intent: request_all_pizzas
#    - action: action_get_all_pizzas
  #  - action: pizza_order_form
  #  - active_loop: pizza_order_form
    #- action: utter_inform_all_pizzas
    #- slot_was_set:
    #  - requested_slot: pizza_type
    #- action: pizza_order_form

# - rule: explain amount in pizza form
#   condition:
#     - active_loop: pizza_order_form
#     #- slot_was_set:
#     #  - requested_slot: pizza_amount
#   steps: 
#     - intent: explain
#     #- active_loop: null
#     - action: utter_explain_pizza_quantities
#     - action: pizza_order_form
#     - active_loop: pizza_order_form

# - rule: explain pizza amount
#   steps:
#   - intent: explain
#   - action: utter_explain

- rule: submit form
  condition:
    - active_loop: pizza_order_form
  steps:
      - action: pizza_order_form      # run the form
      - active_loop: null
      - action: utter_pizza_confirm

- rule: submit form 2
  condition:
    - active_loop: customer_details_form
  steps:
    - action: customer_details_form
    - active_loop: null
    - action: utter_order_complete

- rule: out-of-scope
  steps:
  - intent: out_of_scope
  - action: utter_out_of_scope

- rule: where are you?
  steps:
    - intent: request_restaurant_location
    - action: action_get_restaurant_location
    - action: utter_inform_restaurant_location
    - action: utter_anything_else